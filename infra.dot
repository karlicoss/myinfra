# http://www.graphviz.org/content/cluster

digraph G {
  node [shape="box"];
  rankdir="LR";


subgraph cluster_twittercom {
	label="Twitter";
	style=filled;
	color=lightblue;
	// node [style=filled,color=white];

  tw [label = "Twitter"];
  tw_export;
  tw_api;
	// a0 -> a1 -> a2 -> a3;
}
tw -> tw_api;
tw -> tw_export;

subgraph cluster_endomondo {
	label="Endomondo";
  style=filled;
  color=green;
  endm;
  end_api;
	// node [style=filled];
	// b0 -> b1 -> b2 -> b3;
}

endm -> end_api;


subgraph exports {
  node [shape=cylinder];

  exp_twitter_archives;
  exp_twitter;
  exp_endomondo;
}



subgraph cluster_pipelines {
  label="Pipelines";
  style=filled;
  color=brown;

  twexport;
  endoexport;

  manual_dl[shape=invtrapezium];

  tw_export -> manual_dl  -> exp_twitter_archives;
  tw_api    -> twexport   -> exp_twitter;
  end_api   -> endoexport -> exp_endomondo;

  exp_twitter_archives           -> mypkg;
  exp_twitter   -> dal_twitter   -> mypkg;
  exp_endomondo -> dal_endomondo -> mypkg;
}

# TODO distinguish manual and automatic nodes?
# TODO instead have twexport on edges? ultimately not that much difference..

# TODO position borg above

# TODO svg output with links
subgraph cluster_backups {
  label="Backups";
  borg;

  exp_twitter_archives -> borg [style=dashed];
  exp_twitter          -> borg [style=dashed];
  exp_endomondo        -> borg [style=dashed];
}

# TODO mark edges that use cachew?

subgraph cluster_orger {
  label=Orger;
  module_twitter;
}

subgraph cluster_ui {
  label="User interfaces";
  style=filled;
  color=pink;

  emacs;
  browser;
}

mypkg -> timeline;
mypkg -> dashboard;
mypkg -> module_twitter -> twitter_org;
mypkg -> promnesia;


promnesia -> browser;
timeline  -> browser;
dashboard -> browser;


twitter_org -> emacs;


// a1 -> b3;
// b2 -> a3;
// a3 -> a0;
// a3 -> end;
// b3 -> end;

// end [shape=Mdiamond];
}

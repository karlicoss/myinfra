# http://www.graphviz.org/content/cluster

digraph G {
  # https://stackoverflow.com/a/2012106/706389
  compound=true;

  // concatenate=true; // eh, doesn't seem to work..

  node [shape="box"];
  rankdir="LR";


subgraph cluster_twittercom {
	label="Twitter";
	style=filled;
	color=lightblue;
	// node [style=filled,color=white];

  tw [label = "Twitter"];
  tw_export;
  tw_api;
	// a0 -> a1 -> a2 -> a3;
}
tw -> tw_api;
tw -> tw_export;

subgraph cluster_endomondo {
	label="Endomondo";
  style=filled;
  color=green;
  endm;
  end_api;
	// node [style=filled];
	// b0 -> b1 -> b2 -> b3;
}
endm -> end_api;

# TODO indicate frequencies?

subgraph cluster_kobo {
  label="Kobo reader";
  style=filled;
  color=gray;
  kobo;
  kobo -> kobo_sqlite;
}

# TODO also could show how data gets _into_ the services, i.e. clients?
subgraph cluster_instapaper {
  label="Instapaper";
  style=filled;
  color=lightgray;

  ip;
  ip_api;
}
ip -> ip_api;


# TODO hmm. how to still draw a frame around it?
subgraph cluster_pipelines {
  label="Pipelines";
  style=filled;
  color=brown;

  # meh
  subgraph cluster_exports {
    node [shape=cylinder];
    label="Filesystem";
    rank=same;
    style=dashed;
    color=black;

    exp_kobo;
    exp_twitter_archives;
    exp_twitter;
    exp_endomondo;
    exp_instapaper;
  }


  twexport;
  endoexport;
  ipexport;

  manual_dl[shape=invtrapezium];

  tw_export   -> manual_dl  -> exp_twitter_archives;
  tw_api      -> twexport   -> exp_twitter;

  end_api     -> endoexport -> exp_endomondo;
  ip_api      -> ipexport   -> exp_instapaper;

  kobo_sqlite -> kobuddy    -> exp_kobo;


  exp_twitter_archives            -> mypkg;
  exp_twitter    -> dal_twitter   -> mypkg;
  exp_endomondo  -> dal_endomondo -> mypkg;
  exp_instapaper -> dal_ip        -> mypkg;

  exp_kobo       -> dal_kobuddy   -> mypkg;

}
# TODO mypkg is somewhat specific to my needs
# TODO highlight that it's easy to hook to DAL 

# TODO distinguish manual and automatic nodes?
# TODO instead have twexport on edges? ultimately not that much difference..

# TODO position borg above

# TODO svg output with links
subgraph cluster_backups {
  label="Backups";

  borg;

# exp_kobo             -> borg [style=dashed];
# exp_twitter_archives -> borg [style=dashed];
# exp_twitter          -> borg [style=dashed];
# exp_endomondo        -> borg [style=dashed];
}

exp_twitter -> borg [ltail=cluster_exports];

# TODO mark edges that use cachew?

subgraph cluster_orger {
  label=Orger;
  module_twitter;
  module_kobo;
  module_instapaper;

  module_kobo2org;
  module_ip2org;

  orger_point [shape=point];
}
mypkg -> module_twitter;
mypkg -> module_kobo;
mypkg -> module_instapaper;

# TODO these are read only; contribute to search
module_twitter    -> twitter_org;
module_kobo       -> kobo_org;
module_instapaper -> instapaper_org;

module_kobo2org   -> org_agenda;
module_ip2org     -> org_agenda;

org_agenda -> emacs;

# TODO cloudmacs?
# TODO arctee
# TODO link some of my blog posts? E.g. ones using endomondo



subgraph cluster_ui {
  label="User interfaces";
  style=filled;
  color=pink;

  emacs;
  browser;
  ipython;
}

mypkg -> ipython;

mypkg -> timeline;

mypkg -> dashboard [label="Calendar"];
mypkg -> dashboard [label="Sleep data"];
mypkg -> dashboard [label="Endomondo"];


promnesia [shape=star];


mypkg -> promnesia [label="FB messenger"];
mypkg -> promnesia [label="hypothes.is" ];
mypkg -> promnesia [label="Instapaper"  ];
mypkg -> promnesia [label="org files"   ];
mypkg -> promnesia [label="Pocket"      ];
mypkg -> promnesia [label="Reddit"      ];
# TODO show missing links? like HN
mypkg -> promnesia [label="Telegram"    ];
mypkg -> promnesia [label="Twitter"     ];


promnesia -> browser;
timeline  -> browser;
dashboard -> browser;


{
  kobo_org,
  twitter_org,
  instapaper_org
} -> emacs;

# TODO I guess it's nice to mention where I mention certain bits of infrastructure?

# TODO style blog posts differently?
# TODO position below all

subgraph cluster_blog {
  blog_hb_kcals [
    label="Making sense of Endomondo's calorie estimation";
    URL="https://beepb00p.xyz/heartbeats_vs_kcals.html";
  ];
  blog_mypkg [
    label="my. package";
    URL="https://beepb00p.xyz/mypkg.html";
  ];
  blog_orger;
}
# TODO https://beepb00p.xyz/takeout-data-gone.html

# TODO use different line styles...
# TODO pipelines could link to sad state
orger_point -> blog_orger;
mypkg -> blog_hb_kcals;
mypkg -> blog_mypkg;
// 

}
